{
  "id": "lua-api-java-lua-bridge",
  "title": "Java-Lua Bridge Patterns",
  "slug": "java-lua-bridge",
  "version": "build-41",
  "section": "modding",
  "category": "lua-api",
  "tags": [
    "lua",
    "item",
    "weapon",
    "event",
    "api",
    "java",
    "bridge"
  ],
  "content": "# Java-Lua Bridge Patterns\r\n\r\n## How DAMN Makes API Calls to Java\r\n\r\nThe DAMN library uses a **client-server command dispatch pattern** to bridge Lua and Java safely in multiplayer.\r\n\r\n---\r\n\r\n## 1. Client → Server Command Dispatch\r\n\r\n### Core Pattern (DAMN_Client.lua)\r\n\r\n```lua\r\nfunction DAMN:sendClientCommand(moduleName, methodName, args, vehicle)\r\n    if vehicle then\r\n        args[\"_vehicleId\"] = vehicle:getId();\r\n    end\r\n    sendClientCommand(getPlayer(), moduleName, methodName, args or {});\r\nend\r\n\r\nfunction DAMN:sendLibCommand(methodName, args, vehicle)\r\n    DAMN:sendClientCommand(\"that_damn_lib\", methodName, args or {}, vehicle);\r\nend\r\n```\r\n\r\n### Example Usage\r\n\r\n```lua\r\n-- Send command from client to server\r\nDAMN:sendLibCommand(\"silentPartInstall\", {\r\n    part = part:getId(),\r\n    item = itemId,\r\n}, part:getVehicle());\r\n```\r\n\r\n---\r\n\r\n## 2. Server-Side Command Handling\r\n\r\n### Handler Registration (DAMN_Server.lua)\r\n\r\n```lua\r\nEvents.OnClientCommand.Add(function(moduleName, command, playerObj, args)\r\n    if moduleName == \"that_damn_lib\" and DAMN.Commands[command] then\r\n        -- Resolve vehicle from vehicleId\r\n        if args[\"_vehicleId\"] then\r\n            vehicle = getVehicleById(args[\"_vehicleId\"]);\r\n            args[\"_vehicle\"] = vehicle;\r\n        end\r\n\r\n        -- Execute command handler\r\n        DAMN.Commands[command](playerObj, args);\r\n    end\r\nend);\r\n```\r\n\r\n### Command Handler Example (DAMN_Commands.lua)\r\n\r\n```lua\r\nfunction DAMN.Commands.silentPartInstall(playerObj, args)\r\n    item = InventoryItemFactory.CreateItem(args[\"item\"]);\r\n    part = args[\"_vehicle\"]:getPartById(args[\"part\"]);\r\n\r\n    if part and item then\r\n        part:setInventoryItem(item);\r\n        args[\"_vehicle\"]:transmitPartItem(part);\r\n\r\n        -- Call installation completion handler\r\n        local installTable = part:getTable(\"install\");\r\n        if installTable and installTable[\"complete\"] then\r\n            VehicleUtils.callLua(installTable[\"complete\"], args[\"_vehicle\"], part);\r\n        end\r\n\r\n        -- Set item condition and stats\r\n        part:setRandomCondition(item);\r\n        part:doInventoryItemStats(part:getInventoryItem(), part:getMechanicSkillInstaller());\r\n        args[\"_vehicle\"]:transmitPartCondition(part);\r\n    end\r\nend\r\n```\r\n\r\n---\r\n\r\n## 3. Direct Java Method Calls from Lua\r\n\r\nProject Zomboid exposes Java objects directly to Lua. Here are the key patterns:\r\n\r\n### Vehicle Operations\r\n\r\n```lua\r\n-- Get vehicle by ID\r\nlocal vehicle = getVehicleById(vehicleId);\r\n\r\n-- Get vehicle part\r\nlocal part = vehicle:getPartById(\"TireFrontLeft\");\r\n\r\n-- Get item from part\r\nlocal item = part:getInventoryItem();\r\n\r\n-- Modify part\r\npart:setInventoryItem(item);\r\npart:setCondition(100);\r\npart:setModelVisible(\"modelName\", true);\r\n\r\n-- Get properties\r\nlocal condition = part:getCondition();\r\nlocal wheelIndex = part:getWheelIndex();\r\n```\r\n\r\n### Synchronization (Critical for Multiplayer)\r\n\r\n```lua\r\n-- Sync all vehicle moddata to other players\r\nvehicle:transmitModData();\r\n\r\n-- Sync specific part data\r\nvehicle:transmitPartModData(part);\r\nvehicle:transmitPartItem(part);\r\nvehicle:transmitPartCondition(part);\r\n```\r\n\r\n### Java Factory Calls\r\n\r\n```lua\r\n-- Create items from Java InventoryItemFactory\r\nitem = InventoryItemFactory.CreateItem(itemType);\r\n\r\n-- Access ScriptManager for definitions\r\nlocal vehicleScript = getScriptManager():getVehicle(fullVehicleScript);\r\nvehicleScript:Load(scriptName, configString);\r\n\r\n-- Call Lua functions from Java context\r\nVehicleUtils.callLua(installTable[\"complete\"], vehicle, part);\r\n```\r\n\r\n---\r\n\r\n## 4. Key Java Objects Exposed to Lua\r\n\r\n| Java Object | Lua Access | Purpose |\r\n|-------------|------------|---------|\r\n| `IsoVehicle` | `getVehicleById()` | Main vehicle object with parts |\r\n| `VehiclePart` | `vehicle:getPartById()` | Individual vehicle parts |\r\n| `InventoryItem` | `InventoryItemFactory.CreateItem()` | Items that can be installed |\r\n| `IsoPlayer` | `getPlayer()` | Player/character object |\r\n| `ModData` | `object:getModData()` | Persistent data storage |\r\n| `ScriptManager` | `getScriptManager()` | Access to game definitions |\r\n| `ScriptItem` | `ScriptManager.instance:getItem()` | Item script definitions |\r\n\r\n---\r\n\r\n## 5. Data Persistence with ModData\r\n\r\nThe ModData system allows persisting custom data on game objects:\r\n\r\n```lua\r\n-- Save custom data on vehicle\r\nvehicle:getModData()[\"customKey\"] = value;\r\nvehicle:transmitModData();  -- Sync to other players\r\n\r\n-- Save data on specific part\r\npart:getModData()[\"saveCond\"] = part:getCondition();\r\nvehicle:transmitPartModData(part);\r\n\r\n-- Save data on item\r\nitem:getModData()[\"OutcastTier\"] = \"Legendary\";\r\n```\r\n\r\n---\r\n\r\n## 6. Applying to Weapons/Items\r\n\r\nFor weapon modification (like Grave Index), the same patterns apply:\r\n\r\n```lua\r\n-- Get weapon from player\r\nlocal weapon = player:getPrimaryHandItem();\r\n\r\n-- Check if it's the weapon we want\r\nif weapon and weapon:getFullType() == \"Outcast.GraveIndex\" then\r\n    -- Access weapon properties via Java methods\r\n    local damage = weapon:getMaxDamage();\r\n    local condition = weapon:getCondition();\r\n\r\n    -- Modify via moddata for custom properties\r\n    local modData = weapon:getModData();\r\n    modData[\"OutcastTier\"] = \"Tier3\";\r\n    modData[\"CustomDamageBonus\"] = 1.5;\r\n\r\n    -- Access script for base stats\r\n    local script = weapon:getScriptItem();\r\n    local baseDamage = script:getMaxDamage();\r\nend\r\n```\r\n\r\n### Key Weapon Java Methods\r\n\r\n```lua\r\nweapon:getMaxDamage()\r\nweapon:getMinDamage()\r\nweapon:getCondition()\r\nweapon:setCondition(value)\r\nweapon:getAmmoType()\r\nweapon:getModData()\r\nweapon:getFullType()\r\nweapon:getScriptItem()\r\n```\r\n",
  "excerpt": "The DAMN library uses a client-server command dispatch pattern to bridge Lua and Java safely in multiplayer.\r\n\r\n---\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n---\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n---\r\n\r\n\r\n\r\nProject Zomboid expo...",
  "lastUpdated": "2026-01-09",
  "difficulty": "advanced",
  "tableOfContents": [
    {
      "id": "how-damn-makes-api-calls-to-java",
      "text": "How DAMN Makes API Calls to Java",
      "level": 2
    },
    {
      "id": "1-client-server-command-dispatch",
      "text": "1. Client → Server Command Dispatch",
      "level": 2
    },
    {
      "id": "core-pattern-damn_clientlua",
      "text": "Core Pattern (DAMN_Client.lua)",
      "level": 3
    },
    {
      "id": "example-usage",
      "text": "Example Usage",
      "level": 3
    },
    {
      "id": "2-server-side-command-handling",
      "text": "2. Server-Side Command Handling",
      "level": 2
    },
    {
      "id": "handler-registration-damn_serverlua",
      "text": "Handler Registration (DAMN_Server.lua)",
      "level": 3
    },
    {
      "id": "command-handler-example-damn_commandslua",
      "text": "Command Handler Example (DAMN_Commands.lua)",
      "level": 3
    },
    {
      "id": "3-direct-java-method-calls-from-lua",
      "text": "3. Direct Java Method Calls from Lua",
      "level": 2
    },
    {
      "id": "vehicle-operations",
      "text": "Vehicle Operations",
      "level": 3
    },
    {
      "id": "synchronization-critical-for-multiplayer",
      "text": "Synchronization (Critical for Multiplayer)",
      "level": 3
    },
    {
      "id": "java-factory-calls",
      "text": "Java Factory Calls",
      "level": 3
    },
    {
      "id": "4-key-java-objects-exposed-to-lua",
      "text": "4. Key Java Objects Exposed to Lua",
      "level": 2
    },
    {
      "id": "5-data-persistence-with-moddata",
      "text": "5. Data Persistence with ModData",
      "level": 2
    },
    {
      "id": "6-applying-to-weaponsitems",
      "text": "6. Applying to Weapons/Items",
      "level": 2
    },
    {
      "id": "key-weapon-java-methods",
      "text": "Key Weapon Java Methods",
      "level": 3
    }
  ]
}
{
  "id": "events-player",
  "title": "Player Events",
  "slug": "events-player",
  "version": "build-41",
  "section": "modding",
  "category": "lua-api",
  "tags": ["events", "player", "movement", "death", "xp", "skills", "intermediate"],
  "excerpt": "Complete reference for player events: movement, death, XP gain, skill leveling, and character updates.",
  "lastUpdated": "2026-01-10",
  "difficulty": "intermediate",
  "tableOfContents": [
    { "id": "overview", "text": "Overview", "level": 2 },
    { "id": "player-update-events", "text": "Player Update Events", "level": 2 },
    { "id": "player-state-events", "text": "Player State Events", "level": 2 },
    { "id": "xp-skill-events", "text": "XP & Skill Events", "level": 2 },
    { "id": "equipment-events", "text": "Equipment Events", "level": 2 },
    { "id": "common-patterns", "text": "Common Patterns", "level": 2 },
    { "id": "related", "text": "Related", "level": 2 }
  ],
  "content": "# Player Events\n\n## Overview\n\nPlayer events fire when the player character moves, takes damage, dies, gains XP, or changes equipment. These events are essential for mods that modify player behavior or track player statistics.\n\n---\n\n## Player Update Events\n\n### OnPlayerUpdate\n**When:** Every frame, per player\n**Parameters:** `player` (IsoPlayer)\n**Use Case:** Continuous player monitoring (use sparingly - performance impact)\n\n```lua\nEvents.OnPlayerUpdate.Add(function(player)\n    -- Called every frame - be careful!\n    if player:isAsleep() then\n        -- Player is sleeping\n    end\n    \n    -- Check for specific conditions\n    if player:getMoodles():getMoodleLevel(MoodleType.Tired) >= 3 then\n        -- Player is very tired\n    end\nend)\n```\n**Files that listen:** 11+ vanilla files\n**Performance:** HIGH IMPACT - runs every frame\n\n---\n\n### OnPlayerMove\n**When:** Player moves\n**Parameters:** `player` (IsoPlayer)\n**Use Case:** Movement-triggered effects, footstep sounds, terrain checks\n\n```lua\nEvents.OnPlayerMove.Add(function(player)\n    local square = player:getCurrentSquare()\n    if square then\n        -- Check terrain\n        if square:isOutside() then\n            -- Player moved outside\n        end\n    end\nend)\n```\n\n---\n\n### OnCreatePlayer\n**When:** Player character is created\n**Parameters:** `playerIndex` (int), `player` (IsoPlayer)\n**Use Case:** Player-specific initialization, modData setup\n\n```lua\nEvents.OnCreatePlayer.Add(function(playerIndex, player)\n    print(\"Player\", playerIndex, \"created:\", player:getUsername())\n    \n    -- Initialize player-specific mod data\n    local modData = player:getModData()\n    modData.myMod = modData.myMod or {\n        kills = 0,\n        distanceTraveled = 0,\n        daysSurvived = 0\n    }\nend)\n```\n\n---\n\n### OnCreateSurvivor\n**When:** NPC survivor is created\n**Parameters:** `survivor` (IsoSurvivor)\n**Use Case:** NPC initialization, custom NPC behavior\n\n```lua\nEvents.OnCreateSurvivor.Add(function(survivor)\n    print(\"Survivor created:\", survivor:getFullName())\nend)\n```\n\n---\n\n### OnCharacterCreateStats\n**When:** Character stats are being calculated during creation\n**Parameters:** `player` (IsoPlayer)\n**Use Case:** Modify starting stats based on traits/profession\n\n```lua\nEvents.OnCharacterCreateStats.Add(function(player)\n    -- Modify stats after character creation\n    local traits = player:getTraits()\n    if traits:contains(\"Athletic\") then\n        -- Boost fitness further\n        player:getBodyDamage():setFitnessLevel(player:getPerkLevel(Perks.Fitness) + 1)\n    end\nend)\n```\n\n---\n\n## Player State Events\n\n### OnPlayerDeath\n**When:** Player dies\n**Parameters:** `player` (IsoPlayer)\n**Use Case:** Death handling, statistics, respawn logic\n\n```lua\nEvents.OnPlayerDeath.Add(function(player)\n    local day = getGameTime():getDay()\n    local hours = getGameTime():getWorldAgeHours()\n    \n    print(player:getUsername(), \"died on day\", day)\n    print(\"Survived for\", hours, \"hours\")\n    \n    -- Save death statistics\n    local modData = ModData.getOrCreate(\"DeathStats\")\n    modData.totalDeaths = (modData.totalDeaths or 0) + 1\nend)\n```\n**Files that listen:** 11+ vanilla files\n\n---\n\n### OnInfectionCheck\n**When:** Infection status is checked (zombie virus)\n**Parameters:** `player` (IsoPlayer)\n**Use Case:** Custom infection handling, cure systems\n\n```lua\nEvents.OnInfectionCheck.Add(function(player)\n    if player:getBodyDamage():IsInfected() then\n        -- Player is infected\n        local infectionLevel = player:getBodyDamage():getInfectionLevel()\n        print(\"Infection level:\", infectionLevel)\n    end\nend)\n```\n\n---\n\n## XP & Skill Events\n\n### AddXP\n**When:** Player gains XP in any skill\n**Parameters:** `player` (IsoPlayer), `perk` (PerkFactory.Perks), `amount` (float)\n**Use Case:** XP tracking, bonus XP systems, skill caps\n\n```lua\nEvents.AddXP.Add(function(player, perk, amount)\n    print(player:getUsername(), \"gained\", amount, \"XP in\", tostring(perk))\n    \n    -- Track total XP gained\n    local modData = player:getModData()\n    modData.totalXP = (modData.totalXP or 0) + amount\nend)\n```\n\n---\n\n### LevelPerk\n**When:** Player levels up a skill\n**Parameters:** `player` (IsoPlayer), `perk` (PerkFactory.Perks), `level` (int)\n**Use Case:** Level-up notifications, bonus rewards, achievement tracking\n\n```lua\nEvents.LevelPerk.Add(function(player, perk, level)\n    print(player:getUsername(), \"leveled up\", tostring(perk), \"to level\", level)\n    \n    -- Award bonus for reaching level 5\n    if level == 5 then\n        -- Give reward item\n        player:getInventory():AddItem(\"Base.SkillBook\" .. tostring(perk))\n    end\nend)\n```\n\n---\n\n## Equipment Events\n\n### OnClothingUpdated\n**When:** Player clothing changes (equip, remove, wash, dye)\n**Parameters:** `player` (IsoPlayer)\n**Use Case:** Outfit tracking, armor calculations, visual effects\n\n```lua\nEvents.OnClothingUpdated.Add(function(player)\n    -- Recalculate armor value\n    local wornItems = player:getWornItems()\n    local totalProtection = 0\n    \n    for i = 0, wornItems:size() - 1 do\n        local item = wornItems:get(i):getItem()\n        if item then\n            totalProtection = totalProtection + (item:getBiteDefense() or 0)\n        end\n    end\n    \n    player:getModData().totalProtection = totalProtection\nend)\n```\n**Triggered in:** Many TimedActions (wear, wash, dye, etc.)\n\n---\n\n### OnEquipPrimary\n**When:** Primary weapon is equipped\n**Parameters:** `player` (IsoPlayer), `item` (InventoryItem)\n**Use Case:** Weapon tracking, special weapon effects\n\n```lua\nEvents.OnEquipPrimary.Add(function(player, item)\n    if item then\n        print(\"Equipped primary:\", item:getDisplayName())\n        \n        -- Check for custom weapon effects\n        if item:hasTag(\"Blessed\") then\n            enableBlessedWeaponEffects(player)\n        end\n    else\n        print(\"Unequipped primary weapon\")\n    end\nend)\n```\n\n---\n\n### OnEquipSecondary\n**When:** Secondary item is equipped (off-hand)\n**Parameters:** `player` (IsoPlayer), `item` (InventoryItem)\n**Use Case:** Dual-wield tracking, shield effects\n\n```lua\nEvents.OnEquipSecondary.Add(function(player, item)\n    if item then\n        print(\"Equipped secondary:\", item:getDisplayName())\n    end\nend)\n```\n\n---\n\n## Common Patterns\n\n### Player Statistics Tracking\n\n```lua\nlocal PlayerStats = {}\n\nEvents.OnCreatePlayer.Add(function(playerIndex, player)\n    -- Initialize stats on player creation\n    local modData = player:getModData()\n    modData.stats = modData.stats or {\n        zombiesKilled = 0,\n        daysSurvived = 0,\n        distanceTraveled = 0,\n        itemsCrafted = 0\n    }\nend)\n\nEvents.OnZombieDead.Add(function(zombie)\n    local player = getPlayer()\n    if player then\n        local dist = zombie:DistTo(player)\n        if dist < 20 then  -- Player likely killed it\n            local modData = player:getModData()\n            modData.stats.zombiesKilled = modData.stats.zombiesKilled + 1\n        end\n    end\nend)\n\nEvents.EveryDays.Add(function()\n    local player = getPlayer()\n    if player then\n        local modData = player:getModData()\n        modData.stats.daysSurvived = modData.stats.daysSurvived + 1\n    end\nend)\n```\n\n### XP Multiplier System\n\n```lua\nlocal originalAddXP = nil\n\nEvents.OnGameStart.Add(function()\n    -- Store original function if you need to modify behavior\n    -- Note: Direct XP modification is done via AddXP event\nend)\n\nEvents.AddXP.Add(function(player, perk, amount)\n    -- Apply bonus XP during certain conditions\n    local bonus = 0\n    \n    -- Weekend bonus (example)\n    if isWeekend() then\n        bonus = amount * 0.25  -- 25% bonus\n    end\n    \n    -- Study bonus if reading\n    if player:isReading() then\n        bonus = bonus + amount * 0.1  -- 10% reading bonus\n    end\n    \n    if bonus > 0 then\n        player:getXp():AddXP(perk, bonus, false, false, false)\n    end\nend)\n```\n\n### Death Penalty System\n\n```lua\nEvents.OnPlayerDeath.Add(function(player)\n    -- Save death location for corpse run\n    local modData = ModData.getOrCreate(\"DeathSystem\")\n    modData.lastDeath = {\n        x = player:getX(),\n        y = player:getY(),\n        z = player:getZ(),\n        time = getGameTime():getWorldAgeHours()\n    }\n    \n    -- Apply death penalty\n    local penalty = ModData.getOrCreate(\"PlayerPenalty\")\n    penalty.deaths = (penalty.deaths or 0) + 1\n    penalty.xpPenalty = math.min(penalty.deaths * 0.05, 0.25)  -- Max 25% penalty\nend)\n```\n\n### Equipment Set Bonus\n\n```lua\nlocal function checkSetBonus(player)\n    local wornItems = player:getWornItems()\n    local setCount = 0\n    \n    -- Check for set pieces\n    for i = 0, wornItems:size() - 1 do\n        local item = wornItems:get(i):getItem()\n        if item and item:hasTag(\"MySet\") then\n            setCount = setCount + 1\n        end\n    end\n    \n    -- Apply set bonus\n    local modData = player:getModData()\n    if setCount >= 3 then\n        modData.setBonus = \"full\"\n        -- Apply full set bonus\n    elseif setCount >= 2 then\n        modData.setBonus = \"partial\"\n        -- Apply partial bonus\n    else\n        modData.setBonus = nil\n    end\nend\n\nEvents.OnClothingUpdated.Add(function(player)\n    checkSetBonus(player)\nend)\n```\n\n---\n\n## Related\n\n- [Events Overview](/build-41/modding/lua-api/events-overview) - Introduction to events\n- [Lifecycle Events](/build-41/modding/lua-api/events-lifecycle) - Game boot, start, save events\n- [Timed Actions](/build-41/modding/lua-api/timed-actions) - Custom action system\n- [Context Menus](/build-41/modding/lua-api/context-menus) - Right-click menu system"
}

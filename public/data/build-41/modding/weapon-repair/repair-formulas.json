{
  "id": "weapon-repair-repair-formulas",
  "title": "Repair Formulas and Calculations",
  "slug": "repair-formulas",
  "version": "build-41",
  "section": "modding",
  "category": "weapon-repair",
  "tags": [
    "lua",
    "item",
    "repair",
    "weapon",
    "formulas",
    "and",
    "calculations"
  ],
  "content": "# Repair Formulas and Calculations\r\n\r\n## Condition Degradation\r\n\r\n### Weapon Degradation Formula\r\n\r\nWhen using a weapon, condition loss is calculated per action:\r\n\r\n```lua\r\nif ZombRand(conditionLowerChance * 2 + maintenanceMod * 2) == 0 then\r\n    -- Condition decreases by 1\r\n    condition = condition - 1\r\nelse\r\n    -- No degradation, gain Maintenance XP\r\n    AddXP(Perks.Maintenance, 1)\r\nend\r\n```\r\n\r\n**Variables:**\r\n- `conditionLowerChance` = Item's `ConditionLowerChanceOneIn` property\r\n- `maintenanceMod` = Player's Maintenance skill modifier\r\n\r\n**Example:**\r\n- Axe has `ConditionLowerChanceOneIn = 15`\r\n- Player has Maintenance level 5 (modifier ~2.5)\r\n- Chance of degradation = 1 / (15 * 2 + 2.5 * 2) = 1/35 â‰ˆ 2.9%\r\n\r\n### Maintenance Skill Effect\r\n\r\nHigher Maintenance skill = lower degradation chance:\r\n\r\n| Maintenance Level | Approximate Modifier | Effect |\r\n|-------------------|----------------------|--------|\r\n| 0 | 0 | Base degradation rate |\r\n| 3 | ~1.5 | ~15% reduction |\r\n| 5 | ~2.5 | ~25% reduction |\r\n| 7 | ~3.5 | ~35% reduction |\r\n| 10 | ~5.0 | ~50% reduction |\r\n\r\n## Repair Calculations\r\n\r\n### Condition Restoration\r\n\r\nThe FixingManager calculates restoration based on:\r\n\r\n1. **Item Type** - Different items have different base restoration\r\n2. **Player Skill Level** - Higher skill = more restoration\r\n3. **Fixer Type** - Skill-based fixers often provide better results\r\n\r\n**Approximate Formula (derived from gameplay):**\r\n```\r\nconditionRestored = baseAmount * (1 + skillBonus) * conditionModifier\r\n```\r\n\r\nWhere:\r\n- `baseAmount` = Fixer-specific base restoration\r\n- `skillBonus` = 0.1 per skill level above requirement\r\n- `conditionModifier` = From fixing definition (default 1.0)\r\n\r\n### Engine Repair Formula (Exact)\r\n\r\n```lua\r\nlocal condPerPart = 1 + (skillLevel / 2)\r\nif condPerPart > 5 then\r\n    condPerPart = 5\r\nend\r\n\r\n-- For each EnginePart used:\r\ncondition = condition + condPerPart\r\nif condition > 100 then\r\n    condition = 100\r\nend\r\n```\r\n\r\n**Examples:**\r\n| Skill Above Requirement | Condition Per Part |\r\n|-------------------------|-------------------|\r\n| 0 | 1 |\r\n| 1 | 1.5 |\r\n| 2 | 2 |\r\n| 4 | 3 |\r\n| 6 | 4 |\r\n| 8+ | 5 (max) |\r\n\r\n### Clothing Repair Duration\r\n\r\n```lua\r\nmaxTime = 150 - (tailoringLevel * 6)\r\n```\r\n\r\n| Tailoring Level | Duration (ticks) | Duration (seconds) |\r\n|-----------------|------------------|-------------------|\r\n| 0 | 150 | ~5.0 |\r\n| 1 | 144 | ~4.8 |\r\n| 3 | 132 | ~4.4 |\r\n| 5 | 120 | ~4.0 |\r\n| 7 | 108 | ~3.6 |\r\n| 10 | 90 | ~3.0 |\r\n\r\n## Success Chance\r\n\r\n### Calculation\r\n\r\n```lua\r\nchanceOfSuccess = 100 - FixingManager.getChanceOfFail(item, player, fixing, fixer)\r\n```\r\n\r\n**Factors Affecting Success:**\r\n1. **Player Skill Level** vs. required level\r\n2. **Item Current Condition** - Lower condition = harder repair\r\n3. **Fixer Type** - Some fixers are more reliable\r\n\r\n### Skill-Based Success Modifiers\r\n\r\n| Skill Difference | Approximate Success Bonus |\r\n|-----------------|--------------------------|\r\n| -2 (below req) | -30% (often fails) |\r\n| -1 (below req) | -15% |\r\n| 0 (at req) | 0% (base) |\r\n| +1 (above req) | +10% |\r\n| +2 (above req) | +20% |\r\n| +5 (above req) | +40% |\r\n\r\n### Failure Consequences\r\n\r\n**Standard Items:**\r\n- Repair fails, materials consumed\r\n- Item condition unchanged\r\n- May need to try again\r\n\r\n**Vehicle Parts:**\r\n```lua\r\nif ZombRand(failure) < 100 then\r\n    -- Failed repair damages part\r\n    condition = condition - ZombRand(5, 10)\r\nend\r\n```\r\n\r\n## Condition Caps\r\n\r\n### Maximum Condition\r\n\r\n```lua\r\nif condition >= 100 then\r\n    condition = 100  -- Hard cap\r\nend\r\n```\r\n\r\nAll items cap at 100 condition regardless of `ConditionMax` in scripts.\r\n\r\n### Minimum Condition\r\n\r\n```lua\r\nif condition <= 0 then\r\n    item:setCondition(0)\r\n    -- Item is now broken (isBroken() returns true)\r\nend\r\n```\r\n\r\n## XP Gain Formulas\r\n\r\n### Maintenance XP (Weapon Usage)\r\n\r\n```lua\r\n-- When condition doesn't degrade:\r\nAddXP(Perks.Maintenance, 1)\r\n```\r\n\r\nGained every time weapon is used without losing condition.\r\n\r\n### Mechanics XP (Engine Repair)\r\n\r\n```lua\r\n-- Per engine part used:\r\nAddXP(Perks.Mechanics, numberOfPartsUsed)\r\n```\r\n\r\nOnly on first repair (tracked via `getMechanicsItem()`).\r\n\r\n### Tailoring XP (Clothing Repair)\r\n\r\n```lua\r\nAddXP(Perks.Tailoring, ZombRand(1, 3))\r\n```\r\n\r\nRandom 1-3 XP per patch applied.\r\n\r\n## Repair Cost Analysis\r\n\r\n### Material Efficiency Comparison\r\n\r\n| Material | Uses | Skill Req | Efficiency Rating |\r\n|----------|------|-----------|-------------------|\r\n| Woodglue | 2 | Woodwork 2 | High (skilled repair) |\r\n| DuctTape | 2 | None | Medium |\r\n| Glue | 2 | None | Medium |\r\n| Scotchtape | 4 | None | Low (uses more) |\r\n\r\n### Firearm Repair Cost\r\n\r\nRepairing a firearm consumes the same type of weapon:\r\n- 1 Pistol + Aiming 3 = Repairs 1 Pistol\r\n- Effective cost: 50% (lose 1, keep 1 repaired)\r\n\r\n### Fixer Uses Consumed\r\n\r\n```lua\r\nlocal usesNeeded = fixer:getNumberOfUse()\r\n-- Consumes this many uses from fixer item\r\n```\r\n\r\n## Practical Examples\r\n\r\n### Example 1: Repairing an Axe\r\n\r\n**Scenario:**\r\n- Axe at 30% condition\r\n- Player has Woodwork level 4\r\n\r\n**With Woodglue:**\r\n- Skill requirement: Woodwork 2 (player exceeds by 2)\r\n- Expected restoration: ~40-50%\r\n- Success chance: ~90%\r\n- Result: Axe restored to ~70-80%\r\n\r\n**With DuctTape:**\r\n- No skill requirement\r\n- Expected restoration: ~30-40%\r\n- Success chance: ~85%\r\n- Result: Axe restored to ~60-70%\r\n\r\n### Example 2: Repairing a Pistol\r\n\r\n**Scenario:**\r\n- Pistol at 20% condition\r\n- Player has Aiming level 5\r\n\r\n**Process:**\r\n- Requires: Another Pistol (consumed)\r\n- Skill requirement: Aiming 3 (player exceeds by 2)\r\n- Expected restoration: ~50-60%\r\n- Success chance: ~95%\r\n- Result: Pistol restored to ~70-80%\r\n\r\n### Example 3: Vehicle Engine\r\n\r\n**Scenario:**\r\n- Engine at 40% condition\r\n- Player has Mechanics level 6\r\n- Engine requires Mechanics 3\r\n- Player has 5 Engine Parts\r\n\r\n**Calculation:**\r\n- Skill above requirement: 6 - 3 = 3\r\n- Condition per part: 1 + (3 / 2) = 2.5\r\n- Total restoration: 2.5 * 5 = 12.5\r\n- Result: Engine restored to 52.5%\r\n\r\n## Summary Tables\r\n\r\n### Condition Thresholds\r\n\r\n| Condition | State | Can Repair? |\r\n|-----------|-------|-------------|\r\n| 100 | Perfect | No (already max) |\r\n| 50-99 | Damaged | Yes |\r\n| 1-49 | Heavily Damaged | Yes |\r\n| 0 | Broken | Yes (if fixable) |\r\n\r\n### Skill Bonuses\r\n\r\n| Skill Level Above Req | Restoration Bonus | Success Bonus |\r\n|-----------------------|-------------------|---------------|\r\n| 0 | Base | Base |\r\n| +1 | +10% | +10% |\r\n| +2 | +20% | +20% |\r\n| +3 | +25% | +30% |\r\n| +5 | +35% | +40% |\r\n",
  "excerpt": "When using a weapon, condition loss is calculated per action:\r\n\r\n\r\n\r\nVariables:\r\n-  = Item's  property\r\n-  = Player's Maintenance skill modifier\r\n\r\nExample:\r\n- Axe has \r\n- Player has Maintenance le...",
  "lastUpdated": "2026-01-09",
  "difficulty": "intermediate",
  "tableOfContents": [
    {
      "id": "condition-degradation",
      "text": "Condition Degradation",
      "level": 2
    },
    {
      "id": "weapon-degradation-formula",
      "text": "Weapon Degradation Formula",
      "level": 3
    },
    {
      "id": "maintenance-skill-effect",
      "text": "Maintenance Skill Effect",
      "level": 3
    },
    {
      "id": "repair-calculations",
      "text": "Repair Calculations",
      "level": 2
    },
    {
      "id": "condition-restoration",
      "text": "Condition Restoration",
      "level": 3
    },
    {
      "id": "engine-repair-formula-exact",
      "text": "Engine Repair Formula (Exact)",
      "level": 3
    },
    {
      "id": "clothing-repair-duration",
      "text": "Clothing Repair Duration",
      "level": 3
    },
    {
      "id": "success-chance",
      "text": "Success Chance",
      "level": 2
    },
    {
      "id": "calculation",
      "text": "Calculation",
      "level": 3
    },
    {
      "id": "skill-based-success-modifiers",
      "text": "Skill-Based Success Modifiers",
      "level": 3
    },
    {
      "id": "failure-consequences",
      "text": "Failure Consequences",
      "level": 3
    },
    {
      "id": "condition-caps",
      "text": "Condition Caps",
      "level": 2
    },
    {
      "id": "maximum-condition",
      "text": "Maximum Condition",
      "level": 3
    },
    {
      "id": "minimum-condition",
      "text": "Minimum Condition",
      "level": 3
    },
    {
      "id": "xp-gain-formulas",
      "text": "XP Gain Formulas",
      "level": 2
    },
    {
      "id": "maintenance-xp-weapon-usage",
      "text": "Maintenance XP (Weapon Usage)",
      "level": 3
    },
    {
      "id": "mechanics-xp-engine-repair",
      "text": "Mechanics XP (Engine Repair)",
      "level": 3
    },
    {
      "id": "tailoring-xp-clothing-repair",
      "text": "Tailoring XP (Clothing Repair)",
      "level": 3
    },
    {
      "id": "repair-cost-analysis",
      "text": "Repair Cost Analysis",
      "level": 2
    },
    {
      "id": "material-efficiency-comparison",
      "text": "Material Efficiency Comparison",
      "level": 3
    },
    {
      "id": "firearm-repair-cost",
      "text": "Firearm Repair Cost",
      "level": 3
    },
    {
      "id": "fixer-uses-consumed",
      "text": "Fixer Uses Consumed",
      "level": 3
    },
    {
      "id": "practical-examples",
      "text": "Practical Examples",
      "level": 2
    },
    {
      "id": "example-1-repairing-an-axe",
      "text": "Example 1: Repairing an Axe",
      "level": 3
    },
    {
      "id": "example-2-repairing-a-pistol",
      "text": "Example 2: Repairing a Pistol",
      "level": 3
    },
    {
      "id": "example-3-vehicle-engine",
      "text": "Example 3: Vehicle Engine",
      "level": 3
    },
    {
      "id": "summary-tables",
      "text": "Summary Tables",
      "level": 2
    },
    {
      "id": "condition-thresholds",
      "text": "Condition Thresholds",
      "level": 3
    },
    {
      "id": "skill-bonuses",
      "text": "Skill Bonuses",
      "level": 3
    }
  ]
}